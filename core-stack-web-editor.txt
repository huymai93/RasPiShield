version: "3.8"

networks:
  core_net:
    external: true
    name: ${CORE_NET:-rps-core_default}

services:
  npm:
    image: jc21/nginx-proxy-manager:latest
    container_name: npm
    restart: unless-stopped
    networks:
      - core_net
    ports:
      - "80:80"
      - "81:81"
      - "443:443"
    volumes:
      - ${RPS_ROOT}/npm/data:/data
      - ${RPS_ROOT}/npm/letsencrypt:/etc/letsencrypt

  vaultwarden:
    image: vaultwarden/server:latest
    container_name: vaultwarden
    restart: unless-stopped
    networks:
      - core_net
    environment:
      DOMAIN: "${VAULTWARDEN_DOMAIN}"
      # Use ONE of these (prefer the hashed variant):
      # 1) Plain passphrase:
      # ADMIN_TOKEN: "${VAULTWARDEN_ADMIN_TOKEN}"
      # 2) Argon2id PHC string:
      ADMIN_TOKEN: "${VAULTWARDEN_ADMIN_TOKEN_HASH}"
      WEBSOCKET_ENABLED: "true"
    volumes:
      - ${RPS_ROOT}/vaultwarden/data:/data
